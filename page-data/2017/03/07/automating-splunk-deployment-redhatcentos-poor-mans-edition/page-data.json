{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2017/03/07/automating-splunk-deployment-redhatcentos-poor-mans-edition/",
    "result": {"data":{"site":{"siteMetadata":{"title":"RFaircloth Data Nerd"}},"markdownRemark":{"id":"85ad4d46-e795-533d-8fa7-a21120a4993b","excerpt":"I pulled this out of the archives , on request notice this was originally developed for Splunk 6.2.x and RHEL 7.0. Please review the details make sure it is…","html":"<p>I pulled this out of the archives , on request notice this was originally developed for Splunk 6.2.x and RHEL 7.0. Please review the details make sure it is suitable for you and TEST. If I can talk you out of doing things this way I would. Salt is a great way to manage app config its free and just awesome.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;pre class=\"bp-text bp-text-plain hljs\">```\nTitle: Splunk Universal Forwarder Version 6.2.3+ Red Hat Enterprise Linux 7\n\nAuthor: Ryan Faircloth\n\nSummary: Using repositories for version managment of the Splunk Universal Forwarder assists in ensuring managed Red Hat and compatible linux  systems are using the approved version of the software at all times.\n\n[TOC]\n\n## Setup the repository server ##\n1. Install createrepo  and nginx ``` yum install createrepo apache2 ```\n3. Create a user to work with the repository\n\n ```\n sudo adduser  repouser\n ```\n3. Change user to our repouser user all commands for the repository should be executed using this ID\n\n  ```\n  sudo su - repouser\n  ```\n\n## Generate GPG Keys ##\n1. Change user to our repouser user all commands for the repository should be executed using this ID\n\n ```\n sudo su - repouser\n ```\n2. Create the default configuration for gpg by running the command\n\n ```\n gpg --list-keys\n ```\n3. Edit ~/.gnupg/gpg.conf\n * uncomment the line ``` no-greeting ```\n * add the following content to the end of the file\n\n ```\n # Prioritize stronger algorithms for new keys.\n default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 BZIP2 ZLIB ZIP UNCOMPRESSED\n # Use a stronger digest than the default SHA1 for certifications.\n cert-digest-algo SHA512\n ```\n\n4. Generate a new key with the command ``` gpg --gen-key ```\n5. Select the folowing options ON CENTOS/RHEL this procedure must be executed on the console or SSH having logged in as the repouser\n 1. Type of key \"(1) RSA and RSA (default)\"\n 2. Key size \"4096\"\n 3. Expires \"10y\"\n 4. Confirm \"Y\"\n 5. Real Name \"Splunk local repository\"\n 6. Email address on repository contact this generally should be an alias or distribution list\n 7. Leave the comment blank\n 8. Confirm and \"O\" to Okay\n 9. Leave passphrase blank and confirm, a key will be generated not the sub KEY ID in the following example * E507D48E *\n\n ```\n gpg: checking the trustdb\n gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model\n gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u\n gpg: next trustdb check due at 2025-05-24\n pub   4096R/410E1699 2015-05-27 [expires: 2025-05-24]\n       Key fingerprint = 7CB8 81A9 E07F DA7B 83FF  2E1B 8B31 DA83 410E 1699\n uid                  Splunk local repository &lt;repo@example.com>\n sub   4096R/E507D48E 2015-05-27 [expires: 2025-05-24]\n ```\n10. Export the signing keys public component save this content for use later\n\n ```\n gpg --export --armor KEY_ID >~/repo.pub\n ```\n11. Install the new key into the RPM database\n</code></pre></div>\n<p>sudo cp ~/repo.pub /etc/pki/rpm-gpg/RPM-GPG-KEY-splunkrepo\nsudo rpm —import /etc/pki/rpm-gpg/RPM-GPG-KEY-splunkrepo</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">12. Configure RPM signing with the new key\n</code></pre></div>\n<p>echo ”%_signature gpg” > ~/.rpmmacros\necho ”%_gpg_name splunkrepo” >> ~/.rpmmacros\n“</p>\n<ol start=\"13\">\n<li>Create a repository</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir /opt/splunkrepo\ncp splunkforwarder*.rpm /opt/splunkrepo\ncreaterepo /opt/splunkrepo</code></pre></div>\n<ol start=\"14\">\n<li>Configure the local repository create the following configuration /etc/yum.repos.d/splunk.repo</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[splunkrepo]\nname=splunk repository\nbaseurl=file:///opt/splunkrepo/\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-splunkrepo\nenabled=1</code></pre></div>\n<ol start=\"15\">\n<li>Test the local repository by installing splunkforwarder</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo yum update\nsudo yum install splunkforwader</code></pre></div>\n<p>Note: Create a configuration RPM refer to <a href=\"https://fedoraproject.org/wiki/How_to_create_an_RPM_package\">https://fedoraproject.org/wiki/How_to_create_an_RPM_package</a> and <a href=\"https://www.redhat.com/promo/summit/2010/presentations/summit/opensource-for-it-leaders/thurs/pwaterma-2-rpm/RPM-ifying-System-Configurations.pdf\">https://www.redhat.com/promo/summit/2010/presentations/summit/opensource-for-it-leaders/thurs/pwaterma-2-rpm/RPM-ifying-System-Configurations.pdf</a> for more information do not run as root sudo to repouser 17. Prepare the rpm tree <code class=\"language-text\">rpmdev-setuptree</code> 18. Create a spec file with the following content ~/splunkforwarder-baseconfig.spec</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#--------------------------------------------------------------------------\n# This spec file is Copyright 2010, My Company, Inc.\n#--------------------------------------------------------------------------\nSummary: My Company general configuration RPM\nName: splunkforwarder-baseconfig\nVersion: 1\nRelease: 3\nLicense: Copyright 2010, My Company, Inc.\nGroup: MyCompany/Configs\nPackager: Packager Name &lt;my-email@mycompany.com>\nrequires: splunkforwarder\nBuildArch: noarch\n%description\nThis RPM provides general services and security configuration for My Company.\n\n%triggerin -- splunkforwarder\n/opt/splunkforwarder/bin/splunk enable boot-start --accept-license --answer-yes\nservice splunk stop\nif [ -d \"/opt/splunkforwarder/etc/apps/org_all_deploymentclient/local\" ]\nthen\n    echo \"Directory /opt/splunkforwarder/etc/apps/org_all_deploymentclient/local exists.\"\nelse\n    mkdir -p /opt/splunkforwarder/etc/apps/org_all_deploymentclient/local\nfi\necho #Base deployment configuration >/opt/splunkforwarder/etc/apps/org_all_deploymentclient/local/deploymentclient.conf\necho [deployment-client] >>/opt/splunkforwarder/etc/apps/org_all_deploymentclient/local/deploymentclient.conf\n#echoclientName  >>/opt/splunkforwarder/etc/apps/org_all_deploymentclient/local/deploymentclient.conf\necho [deployment-client] >>/opt/splunkforwarder/etc/apps/org_all_deploymentclient/local/deploymentclient.conf\necho targetUri = ds.example.com:8089 >>/opt/splunkforwarder/etc/apps/org_all_deploymentclient/local/deploymentclient.conf\n\nservice splunk start\n\n\n%triggerun -- splunkforwarder\nif [ $1 -eq 0 -a $2 -gt 0 ] ; then\n /opt/splunkforwarder/bin/splunk stop\n /opt/splunkforwarder/bin/splunk disable boot-start\n rm -Rf /opt/splunkforwarder/etc/apps/org_all_deploymentclient\nfi\n%files\n</code></pre></div>\n<ol start=\"18\">\n<li>Build the RPM <code class=\"language-text\">rpmbuild -sign -ba splunkforwarder-baseconfig.spec</code></li>\n<li>Copy the RPM to the repository cp ~/rpmbuild/RPMS/noarch/splunkforwarder-baseconfig-1-3.noarch.rpm / /opt/splunkrepo</li>\n<li>Update repository DB <code class=\"language-text\">createrepo /opt/splunkrepo</code></li>\n<li>Test the rpms</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">yum update\nyum install splunkforwarder-baseconfig</code></pre></div>\n<ol start=\"22\">\n<li>Configure a web server (Apache) for use as a repository server</li>\n<li>Set permissions on the repository folder <code class=\"language-text\">chmod -R 755 /opt/splunkrepo</code></li>\n<li>Create the web server configuration file with the following contents /etc/http/conf.d/splunkrepo.conf</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Alias /splunkrepo/ \"/opt/splunkrepo/\"\n\n&lt;Directory \"/opt/splunkrepo\">\n   Options Indexes FollowSymLinks MultiViews\n   AllowOverride All\n   Require local\n   Order allow,deny\n   Allow from all\n&lt;/Directory></code></pre></div>\n<ol start=\"25\">\n<li>Reload (or restart) the web server <code class=\"language-text\">service httpd reload</code></li>\n<li>Test “ lynx <a href=\"http://localhost/splunkrepo/repodata/repomd.xml\">http://localhost/splunkrepo/repodata/repomd.xml</a> ```</li>\n<li>Enable the new repository on the first test client</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo yum-config-manager --add-repo http://localhost/splunkrepo\nsudo yum update\nsudo yum install splunkforwarder-baseconfig</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>\n<div class=\"bp-popup-modal\"></div><div class=\"bp-controls-wrapper\"></div>","frontmatter":{"title":"Automating Splunk deployment for RedHat/Centos (poor man's edition)","date":"March 07, 2017","description":null}},"previous":{"fields":{"slug":"/2017/03/01/splunk-server-enpoint-aka-things/"},"frontmatter":{"title":"Splunk the server and the enpoint aka All the Things"}},"next":{"fields":{"slug":"/2017/03/08/trust-verify-logs-might-lieing-aka-case-network-tap-traffic-monitoring/"},"frontmatter":{"title":"Trust but verify your logs might be lieing to you aka, the case for network tap traffic monitoring"}}},"pageContext":{"id":"85ad4d46-e795-533d-8fa7-a21120a4993b","previousPostId":"cf43f1ae-6631-50e7-b0ad-82634fe8560b","nextPostId":"8afc59c1-2dbd-54eb-b7f5-31ef1523787e"}},
    "staticQueryHashes": ["2841359383","3257411868"]}