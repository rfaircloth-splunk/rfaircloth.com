{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2015/05/28/splunk-universal-forwarder-version-6-2-3-ubuntu-15-04/",
    "result": {"data":{"site":{"siteMetadata":{"title":"RFaircloth Data Nerd"}},"markdownRemark":{"id":"e439122b-a097-5cf8-83ad-3ab1ed69ddc5","excerpt":"Author: Ryan Faircloth Summary: Using repositories for version managment of the Splunk Universal Forwarder assists in ensuring managed Ubuntu systems are using…","html":"<p>Author: Ryan Faircloth</p>\n<p>Summary: Using repositories for version managment of the Splunk Universal Forwarder assists in ensuring managed Ubuntu systems are using the approved version of the software at all times.</p>\n<h2>Setup the repository server</h2>\n<ol>\n<li>Install reprepro and nginx <code class=\"language-text\">&lt;br>&lt;/br>sudo apt-get install reprepro nginx packaging-dev -y&lt;br>&lt;/br></code></li>\n<li>Create a user to work with the repository <code class=\"language-text\">&lt;br>&lt;/br>adduser --disabled-password --disabled-login --home /srv/reprepro --group reprepro&lt;br>&lt;/br></code></li>\n<li>Change user to our reprepro user all commands for the repository should be executed using this ID</li>\n</ol>\n<p><code class=\"language-text\">&lt;br>&lt;/br> sudo su - reprepro&lt;br>&lt;/br></code></p>\n<h2>Generate GPG Keys</h2>\n<ol>\n<li>Change user to our reprepro user all commands for the repository should be executed using this ID</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo su - reprepro\n</code></pre></div>\n<ol start=\"2\">\n<li>Create the default configuration for gpg by running the command<br>\n<code class=\"language-text\">&lt;br>&lt;/br>gpg --list-keys&lt;br>&lt;/br></code></li>\n<li>Edit ~/.gnupg/gpg.conf</li>\n</ol>\n<ul>\n<li>uncomment the line <code class=\"language-text\">no-greeting</code></li>\n<li>add the following content to the end of the file</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Prioritize stronger algorithms for new keys.\ndefault-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 BZIP2 ZLIB ZIP UNCOMPRESSED\n# Use a stronger digest than the default SHA1 for certifications.\ncert-digest-algo SHA512\n</code></pre></div>\n<ol start=\"4\">\n<li>Generate a new key with the command <code class=\"language-text\">gpg --gen-key</code></li>\n<li>Select the folowing options</li>\n<li>Type of key “(1) RSA and RSA (default)”</li>\n<li>Key size “4096”</li>\n<li>Expires “10y”</li>\n<li>Confirm “Y”</li>\n<li>Real Name “Splunk local repository”</li>\n<li>Email address on repository contact this generally should be an alias or distribution list</li>\n<li>Leave the comment blank</li>\n<li>Confirm and “O” to Okay</li>\n<li>Leave passphrase blank and confirm, a key will be generated not the sub KEY ID in the following example * E507D48E *</li>\n</ol>\n<p><code class=\"language-text\">&lt;br>&lt;/br>gpg: checking the trustdb&lt;br>&lt;/br>gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model&lt;br>&lt;/br>gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u&lt;br>&lt;/br>gpg: next trustdb check due at 2025-05-24&lt;br>&lt;/br>pub 4096R/410E1699 2015-05-27 [expires: 2025-05-24]&lt;br>&lt;/br> Key fingerprint = 7CB8 81A9 E07F DA7B 83FF 2E1B 8B31 DA83 410E 1699&lt;br>&lt;/br>uid Splunk local repository &lt;repo@example.com>&lt;br>&lt;/br>sub 4096R/E507D48E 2015-05-27 [expires: 2025-05-24]&lt;br>&lt;/br></code> 6. Export the signing keys public component save this content for use later</p>\n<p><code class=\"language-text\">&lt;br>&lt;/br>gpg --export --armor KEY_ID >~/repo.pub&lt;br>&lt;/br></code></p>\n<h2>Configure Prerepro</h2>\n<ol>\n<li>Change user to our reprepro user all commands for the repository should be executed using this ID <code class=\"language-text\">sudo su - reprepro</code></li>\n<li>Create the directory structure <code class=\"language-text\">sudo mkdir -p /srv/reprepro/ubuntu/{conf,dists,incoming,indices,logs,pool,project,tmp}</code></li>\n<li>Change directories to the new repository <code class=\"language-text\">cd /srv/reprepro/ubuntu/</code></li>\n<li>Edit the file <code class=\"language-text\">/srv/reprepro/ubuntu/conf/distributions</code></li>\n<li>Update the file contents</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Origin: SplunkEnterprise\nLabel: SplunkEnterprise\nCodename: ponies\nArchitectures: i386 amd64 source\nComponents: main\nDescription: Splunk Enterprise and Universal Forwarders for Debian based systems\nSignWith: YOUR-KEY-ID\n</code></pre></div>\n<ol start=\"6\">\n<li>Edit the file <code class=\"language-text\">/srv/reprepro/ubuntu/conf/options</code></li>\n<li>Update the file contents</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ask-passphrase\nbasedir .\n</code></pre></div>\n<h2>Load the packages</h2>\n<p>Load the packages using the following commands syntax replace package.deb with the correct path to the splunkforwarder deb file</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">reprepro -S utils -P standard includedeb ponies package.deb\n</code></pre></div>\n<h2>Setup the web server</h2>\n<ol>\n<li>Create the file <code class=\"language-text\">/etc/nginx/sites-available/vhost-packages.conf</code></li>\n<li>Use the following content replacing package.local with the fqdn of the repository host ```\nserver {\nlisten 80;\nserver_name packages.internal;\naccess_log /var/log/nginx/packages-access.log;\nerror_log /var/log/nginx/packages-error.log;\nlocation / {\nroot /srv/reprepro;\nindex index.html;\n}\nlocation ~ /(.*)/conf {\ndeny all;\n}\nlocation ~ /(.*)/db {\ndeny all;\n}\n}</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">3. Increase the server name hash bucket by creating the following file `/etc/nginx/conf.d/server_names_hash_bucket_size.conf`\n4. Use the following content `server_names_hash_bucket_size 64;`\n5. Enable the new configuration\n</code></pre></div>\n<p>sudo ln -s /etc/nginx/sites-available/vhost-packages.conf /etc/nginx/sites-enabled/vhost-packages.conf\nsudo service nginx reload</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\nConfigure the repository\n------------------------\n\n1. Edit the file ```\n/etc/apt/sources.list.d/packages.internal.list\n</code></pre></div>\n<ol start=\"2\">\n<li>Use the following content ```\ndeb <a href=\"http://packages.internal/ubuntu/\">http://packages.internal/ubuntu/</a> ponies main</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">3. Import the public key ```\nsudo apt-key add /tmp/repo.pub\n</code></pre></div>\n<ol start=\"4\">\n<li>Update the repository cache ```\nsudo apt-get update</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\nInstall the Splunk Universal Forwarder\n--------------------------------------\n\nRun the following command\n\n`sudo apt-get install splunkforwarder`\n\nConfigure the universal forwarder\n\n- Using best practices to manually create the org\\_deploymentclient configuration app\n- Using RPM based configuration package\n- Using Configuration Managment system such as Puppet or Chef\n\nCreate and install a configuration package for the Universal Forwarder\n----------------------------------------------------------------------\n\nIn the following procedure “org” should be replace with the abbreviate of the organization using the configuration.\n\n1. Create the paths `/srv/reprepro/org_debs/`\n2. Create the path for the first version of the package ie `mkdir org-splunk-ufconfig-1`\n3. Change to the new directory\n4. Create the following structure\n</code></pre></div>\n<p>├── DEBIAN\n│   ├── control (file)\n│   ├── postinst (file)\n│   ├── preinst (file)\n│   └── prerm (file)\n└── opt\n└── splunkforwarder\n└── etc\n└── apps\n└── org_all_deploymentclient\n└── default\n├── deploymentclient.conf (file)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">5. Edit the DEBIAN/control file as follows `&lt;br>&lt;/br>Package: org-splunk-ufconfig&lt;br>&lt;/br>Section: base&lt;br>&lt;/br>Priority: standard&lt;br>&lt;/br>Version: 1&lt;br>&lt;/br>Architecture: all&lt;br>&lt;/br>Maintainer: Your Name &lt;you@email.com>&lt;br>&lt;/br>Depends: splunkforwarder (>=6.0.0)&lt;br>&lt;/br>Description: &lt;insert up to 60 chars description>&lt;br>&lt;/br> &lt;insert long description, indented with spaces>&lt;br>&lt;/br>`\n6. Edit the DEBIAN/postinst\n</code></pre></div>\n<p>#!/bin/bash\n/opt/splunkforwarder/bin/splunk enable boot-start -user splunk —accept-license —answer-yes\nservice splunk start</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">7. Edit the DEBIAN/preinst ```\n#!/bin/bash\nfile=\"/etc/init.d/splunk\"\nif [ -f \"$file\" ]\nthen\n    echo \"$file found.\"\n    service splunk stop\nelse\n    echo \"$file not found.\"\nfi\n</code></pre></div>\n<ol start=\"8\">\n<li>Edit the DEBIAN/prerm ```\n#!/bin/bash\nfile=“/etc/init.d/splunk”\nif [ -f “$file” ]\nthen\necho “$file found.”\nservice splunk stop\n/opt/splunkforwarder/bin/splunk disable boot-start</li>\n</ol>\n<p>else\necho “$file not found.”\nfi</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">9. Update the contents of deploymentclient.conf with the appropriate information for you installation\n10. Add additional content as required for your deployment\n11. Change directories up to the parent of org-splunk-ufconfig–1\n12. Create the debian package with the command `dpkg-deb --build org-splunk-ufconfig-1/`\n13. Change to the repository directory `/srv/reprepro/ubuntu`\n14. Store the new package in the repository\n\n`reprepro -S utils -P standard includedeb ponies /srv/reprepro/org_debs/org-splunk-ufconfig-1.deb`\n15. Install the new package on the client using the command `sudo apt-get install org-splunk-ufconfig` this will install the splunk forwarder package if has not yet been installed.</code></pre></div>","frontmatter":{"title":"Splunk Universal Forwarder Version 6.2.3+ Ubuntu 15.04","date":"May 28, 2015","description":null}},"previous":{"fields":{"slug":"/2015/05/26/splunk-universal-forwarder-version-6-2-3-microsoft-system-center-2012-r2-2/"},"frontmatter":{"title":"Splunk Universal Forwarder Version 6.2.3+ Microsoft System Center 2012 R2"}},"next":{"fields":{"slug":"/2015/09/16/getting-all-the-logs-avoid-the-syslog/"},"frontmatter":{"title":"Getting all the logs, avoid the syslog"}}},"pageContext":{"id":"e439122b-a097-5cf8-83ad-3ab1ed69ddc5","previousPostId":"ed30e246-0b86-5158-b052-7e7ad2f0b8c7","nextPostId":"638622d1-58ac-5589-949e-5e9a88e10195"}},
    "staticQueryHashes": ["2841359383","3257411868"]}