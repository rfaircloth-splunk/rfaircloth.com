{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2019/01/08/building-a-splunk-cim-compatible-source-addon/",
    "result": {"data":{"site":{"siteMetadata":{"title":"RFaircloth Data Nerd"}},"markdownRemark":{"id":"14bab0b8-fae8-507f-8bdf-a9be72fb59ee","excerpt":"This walk through will build a Splunk CIM compatible source addon extending the CEF source type from my CEF framework TA. This is part three in a three part…","html":"<p>This walk through will build a Splunk CIM compatible source addon extending the CEF source type from my CEF framework TA. This is part three in a three part Series</p>\n<p>Before you start, I will have to gloss over many topics you should have:</p>\n<ul>\n<li>Read the prior two articles in this series.</li>\n<li>You should also be comfortable with the ways Splunk can be used to parse and enrich data notable, TRANSFORMS, REPORT, EXTRACT, EVAL, and LOOKUP. A great cheat sheet is available from <a href=\"https://www.aplura.com/wp-content/uploads/2016/09/data_onboarding_cheat_sheet_v2.pdf\">Alpura</a></li>\n<li>Be familiar with the<a href=\"https://docs.splunk.com/Documentation/CIM/4.12.0/User/Web\"> web data model</a>.</li>\n<li>Be familiar with the <a href=\"https://docs.incapsula.com/Content/read-more/log-file-structure.htm#Logfields\">data dictionary</a> for our sample data</li>\n</ul>\n<p>In the prior two articles we create a project style development environment for our add-on and a minimally viable set of field parse but have not yet considered any specific model. Reviewing our samples and vendor documentation we learn the data is most similar to a web access log which is known as the “web” model in the Splunk Common information model. In our case we have only two events available and vendor documentation that describes the events. When replicating this process in a new data source all unique events should be considered.</p>\n<ul>\n<li>All events are a web access event</li>\n<li>A subset of these events are “attack” events which do not have a web model to compare to.</li>\n</ul>\n<p>Considering this we will use the “web” model as our basis and add a number of connivence elements for our users. The following table illustrates how we will map our data.</p>\n<p>The implementation of the mapping is explained in the following table our implementation of the mapping can be viewed in <a href=\"https://bitbucket.org/SPLServices/ta-cef-imperva-incapsula/src/master/src/TA-cef-imperva-incapsula-for-splunk/\">bitbucket</a>. Review default/props.conf default/transforms.conf and the lookups present in lookups/</p>\n<table>\n<thead>\n<tr>\n<th>CEF Field</th>\n<th>Splunk Field</th>\n<th>Notes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>sip</td>\n<td>dest_ip</td>\n<td>Not a CIM field in the web model used by convention.</td>\n</tr>\n<tr>\n<td>Not present in sample not validated</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>spt</td>\n<td>dest_port</td>\n<td>Not a CIM field in the web model used by convention.</td>\n</tr>\n<tr>\n<td>Not present in sample not validated</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>qstr</td>\n<td>uri_query</td>\n<td>The formatting of this field contains escaped equal (=) signs and is omitting the leading question mark (?) used a complex eval to adjust</td>\n</tr>\n<tr>\n<td>cs9</td>\n<td>Rule_Name AND signature</td>\n<td>Not a CIM field however Rule_Name is similar to an attack signature. Use an eval to split by comma and remove empties</td>\n</tr>\n<tr>\n<td>Attack Severity</td>\n<td>CEF_severity</td>\n<td></td>\n</tr>\n<tr>\n<td>severity</td>\n<td>This field requires a lookup to set severity as one of low,medium,high,critical created “imperva_incapsula_severity.csv</td>\n<td></td>\n</tr>\n<tr>\n<td>requestmethod</td>\n<td>http_method</td>\n<td></td>\n</tr>\n<tr>\n<td>ref</td>\n<td>http_referrer</td>\n<td></td>\n</tr>\n<tr>\n<td>requestClientApplication</td>\n<td>http_user_agent</td>\n<td></td>\n</tr>\n<tr>\n<td>dest</td>\n<td>site</td>\n<td></td>\n</tr>\n<tr>\n<td>src_user_id</td>\n<td>user</td>\n<td></td>\n</tr>\n<tr>\n<td>action</td>\n<td>act</td>\n<td>This field requires a lookup to translate act to action which can be allowed or blocked</td>\n</tr>\n<tr>\n<td>vendor_product</td>\n<td>Constant string “Imperva Incapsula”</td>\n<td></td>\n</tr>\n<tr>\n<td>app</td>\n<td>vendor_app</td>\n<td>saved for user search not used in the CIM model</td>\n</tr>\n<tr>\n<td>app</td>\n<td>Constant String “incapsula”</td>\n<td></td>\n</tr>\n<tr>\n<td>act</td>\n<td>cached</td>\n<td>Some values of act can indicate cached which is set to true using the actions lookup above</td>\n</tr>\n</tbody>\n</table>\n<h2>Creating Eventtypes</h2>\n<p>Fields alone are not enough to include an event in a datamodel. In-fact incorrect configuration of eventtypes and tags and include data which is invalid for a model compromising the usefulness of a model.</p>\n<p>We will create two eventtypes for this data, our implementation can be viewed in eventype.conf using the bitbucket link above:</p>\n<table>\n<thead>\n<tr>\n<th>eventtype</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>imperva_incapsula_web</td>\n<td>All events matching our source and sourcetype</td>\n</tr>\n<tr>\n<td>imperva_incapsula_web_attack</td>\n<td>All eventtypes imperva_incapsula_web with a signature field.</td>\n</tr>\n</tbody>\n</table>\n<h2>Creating Tags</h2>\n<p>The final step to include events in a data model is to tag the events. Additional tags can be created in this case “attack” make sense for the subset of events that indicate a detection by the Incapsula WAF service. Tags which are not used by the data model are not included by default and are only available to the users in search activities.</p>\n<table>\n<thead>\n<tr>\n<th>tag</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>web</td>\n<td>eventtype=imperva_incapsula_web</td>\n</tr>\n<tr>\n<td>attack</td>\n<td>eventtype=imperva_incapsula_web_attack</td>\n</tr>\n</tbody>\n</table>\n<h2>Testing our work</h2>\n<p>Using “make package_test” ensure no unexpected errors or warnings are produced.</p>\n<p>Using our development environment and EventGen via “make docker_dev” we can interactively validate our mapping is CIM compliant.</p>","frontmatter":{"title":"Building a Splunk CIM compatible source addon","date":"January 08, 2019","description":null}},"previous":{"fields":{"slug":"/2019/01/07/building-a-cef-source-add-on-for-splunk-enterprise/"},"frontmatter":{"title":"Building a CEF source add on for Splunk Enterprise"}},"next":{"fields":{"slug":"/2019/03/07/five-things-you-can-do-now-to-get-ready-for-splunk-smart-store/"},"frontmatter":{"title":"Five things you can do now to get ready for Splunk Smart Store"}}},"pageContext":{"id":"14bab0b8-fae8-507f-8bdf-a9be72fb59ee","previousPostId":"502d0015-ab9f-5335-9e10-9df7dd43363c","nextPostId":"a2055d6f-7a76-5653-a414-7b7340c9f4c2"}},
    "staticQueryHashes": ["2841359383","3257411868"]}